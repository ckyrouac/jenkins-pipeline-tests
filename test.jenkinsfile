def commitHashForBuild(build) {
  def scmAction = build?.actions.find { action -> action instanceof jenkins.scm.api.SCMRevisionAction }
  return scmAction?.revision?.hash
}

node {
  stage("test") {
    def retval = checkout(scm)

    def lastSuccessfulBuild = currentBuild.rawBuild.getPreviousSuccessfulBuild()
    def lastSuccessfulHash = commitHashForBuild(lastSuccessfulBuild)
    echo retval.toString()
    echo lastSuccessfulHash
  }
}
